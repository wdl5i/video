<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- 引入样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <link rel="stylesheet" href="css/home.css">
    <title>Document</title>
</head>
<body>
    <div id="app">
        <router-view></router-view>
    </div>

    <!-- 登录页模板 -->
    <template id="login">
        <div>
            <p>登录页</p>
            <form class="loginForm">
                <el-input name="userName" placeholder="请输入用户名" clearable></el-input>
                <el-input name="password" placeholder="请输入密码" clearable></el-input>
                <el-button type="primary" @click="login('/user/login')">登录</el-button>
            </form>
        </div>
    </template>

    <!-- 主页模板 -->
    <template id="home">
        <div>
            <el-container>
                <el-header>
                    <el-menu :default-active="activeIndex" class="el-menu-demo" @select="handleSelect" mode="horizontal" background-color="#545c64" text-color="#fff" active-text-color="#ffd04b">
                        <el-menu-item index="1" @click="showAside = true;getGroupList(1,10000);">实时监控</el-menu-item>
                        <el-menu-item index="2" v-show="isUserManageShow == true" @click="showAside = false">
                            <router-link to="/home/userManage">用户管理</router-link>
                        </el-menu-item>
                        <el-menu-item index="3" v-show="userId == 1" @click="showAside = false">
                            <router-link to="/home/auth">用户授权</router-link>
                        </el-menu-item>
                        <el-menu-item index="4" v-show="isFacilityManageShow == true" @click="showAside = false">
                            <router-link to="/home/facilityManage">设备管理</router-link>
                        </el-menu-item>
                        <el-menu-item index="5" v-show="isGroupManageShow == true" @click="showAside = false">
                            <router-link to="/home/groupManage">设备组管理</router-link>
                        </el-menu-item>
                    </el-menu>
                </el-header>
                <el-container>
                    <el-aside v-show="showAside == true" width="200px">
                        <el-menu @open="getThisFacilities" class="el-menu-vertical-demo" background-color="#545c64" text-color="#fff" active-text-color="#ffd04b">
                            <el-submenu :key="groupInfo.id" :index="''+groupInfo.id" v-for="(groupInfo,groupInfoIndex) in groupList" 
                            >
                                <template slot="title">
                                    <i class="el-icon-menu"></i>
                                    <span>{{groupInfo.name}}</span>
                                </template>
                                <el-menu-item :key="facilityInfo.id" :index="groupInfoIndex+''+facilityInfo.id" v-for="facilityInfo in groupInfo.groupFacilityList">{{facilityInfo.name}}</el-menu-item>
                            </el-submenu>
                      </el-menu>
                    </el-aside>
                    <el-main>
                        <router-view></router-view>
                    </el-main>
                </el-container>
            </el-container>       
        </div>
    </template>

    <!-- 用户管理模板 -->
    <template id="userManage">
        <div>
            <div class="crumbs">
                <el-breadcrumb separator="/">
                    <el-breadcrumb-item><i class="el-icon-tickets"></i>用户列表</el-breadcrumb-item>
                </el-breadcrumb>
            </div>
            <div class="container">
                <div class="handle-box">
                    <el-button type="primary" size="small" icon="delete" @click="dialogFormVisible = true;isUserAdd = true" v-show="isUserManageAddShow == true">添加用户</el-button>
                    <!-- <el-button type="primary" icon="delete" class="handle-del mr10" @click="delAll">批量删除</el-button>
                    <el-input v-model="select_word" placeholder="筛选关键词" class="handle-input mr10"></el-input>
                    <el-button type="primary" icon="search" @click="search">搜索</el-button> -->
                </div>
                <el-table :data="userList" stripe border style="width: 100%">
                    <el-table-column prop="name" label="用户名称" width="150" style="font-size:12px"></el-table-column>
                    <el-table-column prop="password" label="密码" width="150"></el-table-column>
                    <el-table-column prop="sex" label="性别" width="100"></el-table-column> 
                    <el-table-column prop="phone" label="电话号码"></el-table-column>
                    <el-table-column prop="groupId" label="设备组" width="100">
                        <template slot-scope="scope">
                            <el-button size="mini" type="primary" @click="getUserGroup(scope.row.id,scope.row.userGroupList);getAllGrpList(scope.row.id)">查看</el-button>
                            <el-checkbox-group v-model="scope.row.checkGroupList">
                                <el-checkbox :key="index" name="groupCheckbox" v-for="(grp,index) in scope.row.userGroupList" :label="grp.id" @change="showThisGrpId(scope.row.id,grp.id)" border>{{grp.name}}</el-checkbox>
                            </el-checkbox-group>     
                        </template>
                    </el-table-column>
                    <el-table-column prop="option" label="操作" width="180">
                        <template slot-scope="scope">
                            <el-button size="mini" @click="dialogFormVisible = true;userUpdate(scope.row.id,scope.row);isUserAdd = false"  v-show="isUserManageUpdateShow == true">修改</el-button>
                            <el-button size="mini"  type="danger" @click="userDelete(scope.row.id)"  v-show="isUserManageDelShow == true">删除</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                <div class="pagination">
                    <el-pagination background @size-change="handleSizeChange" @current-change="handleCurrentChange" 
                    layout="total, sizes, prev, pager, next" :total="total" :page-size="currentSize"
                    :current-page="currentPage" :page-sizes="[10, 20, 50, 100]"></el-pagination>
                </div>
            </div>
            <!-- 对话框 -->
            <el-dialog title="用户添加" :visible.sync="dialogFormVisible">
              <el-form>
                <el-form-item label="用户名称" :label-width="formLabelWidth">
                    <el-input v-model="userInfo.userName" placeholder="请输入用户名" clearable></el-input>
                </el-form-item>
                <el-form-item label="用户密码" :label-width="formLabelWidth">
                    <el-input v-model="userInfo.password" placeholder="请输入密码" clearable></el-input>
                </el-form-item>
                <el-form-item label="电话号码" :label-width="formLabelWidth">
                    <el-input v-model="userInfo.phone" placeholder="请输入电话号码" clearable></el-input>
                </el-form-item>
                <el-form-item label="性别" :label-width="formLabelWidth">
                    <el-radio v-model="userInfo.sex" label="男">男</el-radio>
                    <el-radio v-model="userInfo.sex" label="女">女</el-radio>
                </el-form-item>
              </el-form>
              <span slot="footer" class="dialog-footer">
                <el-button @click="dialogFormVisible = false">取 消</el-button>
                <el-button v-show="isUserAdd == true" type="primary" @click="dialogFormVisible = false;userAdd()">确 定</el-button>
                <el-button v-show="isUserAdd == false" type="primary" @click="dialogFormVisible = false;comfirmUpdate()">确 定</el-button>
              </span>
            </el-dialog>
        </div>
    </template>

    <!-- 设备管理模板 -->
    <template id="facilityManage">
        <div style="width: 500px">
            <p>这里是设备管理的router-view</p>
            <el-button type="primary" size="small" plain @click="getFacilityList(1,20)">获取设备列表</el-button>
            <ul>
                <li v-for="(facilities,facilitiesIndex) in facilityList">
                    {{facilities.name}}--{{facilities.ipAddr}}
                    <el-button type="primary" size="mini" @click="facilityUpdate(facilities.id,facilities)"  v-show="isFacilityManageUpdateShow == true">修改</el-button>
                    <el-button type="danger" size="mini" @click="facilityDelete(facilities.id)"  v-show="isFacilityManageDelShow == true">删除</el-button>
                </li>
            </ul>
            <el-input v-model="facilityInfo.name" placeholder="请输入设备名称" clearable></el-input><br/>
            <el-input v-model="facilityInfo.ipAddr" placeholder="请输入设备IP" clearable></el-input><br/>
            <el-input v-model="facilityInfo.port" placeholder="请输入设备端口" clearable></el-input><br/>
            <el-input v-model="facilityInfo.serial" placeholder="请输入设备serial" clearable></el-input><br/>
            <el-button type="primary" @click="facilityAdd()" v-show="isFacilityManageAddShow == true">添加设备</el-button>
            <el-button type="primary" @click="facilityComfirmUpdate()" id="facilityComfirmUpdate" style="display: none">确认修改</el-button>
        </div>
    </template>
    
    <!-- 设备组管理模板 -->
    <template id="groupManage">
        <div style="width: 500px">
            <p>这里是用户管理的router-view</p>
            <el-button type="primary" size="small" plain @click="getGroupList(1,20)">获取设备组列表</el-button>
            <el-button type="primary" size="small" plain @click="dialogFormVisible = true;isGroupAdd = true" v-show="isGroupManageAddShow == true">添加设备组</el-button>

            <el-table :data="groupList" stripe style="width: 100%">
                <el-table-column prop="name" label="设备组名称" width="180"></el-table-column>
                <el-table-column prop="option" label="操作" width="180">
                    <template slot-scope="scope">
                        <el-button type="primary" size="mini" @click="dialogFormVisible = true;groupUpdate(scope.row.id,scope.row);isGroupAdd = false" v-show="isGroupManageUpdateShow == true">修改</el-button>
                        <el-button type="danger" size="mini" @click="groupDelete(scope.row.id)" v-show="isGroupManageDelShow == true">删除</el-button>
                    </template>
                </el-table-column>
                <el-table-column prop="facilityId" label="关联设备">
                    <template slot-scope="scope">
                        <el-button size="mini" type="primary" @click="getGroupFacilities(scope.row.id,scope.row.groupFacilityList);getAllFacilityList(scope.row.id)">查看</el-button>
                        <!-- <el-tag type="success" v-for="userGroup in scope.row.userGroupList">{{userGroup.name}}</el-tag> -->
                        <!-- <el-checkbox v-for="grp in groupList" :label="grp.id" border @click="showThisGrpId(grp.id)">{{grp.name}}</el-checkbox> -->
                        <el-checkbox-group v-model="scope.row.checkFacilityList">
                            <el-checkbox name="facilityCheckbox" :key="index" v-for="(facility,index) in scope.row.groupFacilityList" :label="facility.id" @change="showThisfacilityId(scope.row.id,facility.id)" border>{{facility.name}}</el-checkbox>
                        </el-checkbox-group>
                        
                    </template>
                </el-table-column>
            </el-table>

            <el-dialog title="设备组添加" :visible.sync="dialogFormVisible">
                <el-form>
                <el-form-item label="设备组名称" :label-width="formLabelWidth">
                    <el-input v-model="groupInfo.name" placeholder="请输入设备组名称" clearable></el-input>
                </el-form-item>
                </el-form>
                <span slot="footer" class="dialog-footer">
                    <el-button @click="dialogFormVisible = false">取 消</el-button>
                    <el-button v-show="isGroupAdd == true" type="primary" @click="dialogFormVisible = false;groupAdd()">确 定</el-button>
                    <el-button v-show="isGroupAdd == false" type="primary" @click="dialogFormVisible = false;groupComfirmUpdate()">确 定</el-button>
                </span>
            </el-dialog>
        </div>
    </template>

    <!-- 用户授权模板 -->
    <template id="auth">
        <div>
            <p>这里是用户授权的router-view
                <el-button type="primary" size="small" plain @click="getAuthUserList(1,20);getMenuTree()">获取授权用户列表</el-button>
            </p>
            

            <div style="width: 30%;display: inline-block;">
                <el-table :data="authUserList" stripe style="width: 100%">
                    <el-table-column prop="name" label="用户名称" width="180"></el-table-column>
                    <el-table-column prop="option" label="操作" width="180">
                        <template slot-scope="scope">
                            <el-button size="mini" @click="getUserTree(scope.row.id);showTree = true">授权</el-button>
                        </template>
                    </el-table-column>
                </el-table>
            </div>
            <div style="width: 50%;display: inline-block;" v-show='showTree == true'>
                <el-tree :data="TreeData" show-checkbox ref="tree" node-key="id" :check-strictly='true' default-expand-all :props="defaultProps" @check="checkChange"></el-tree>
            </div>
        </div>
    </template>

    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="js/vue.js"></script>
    <script type="text/javascript" src="js/vue-router.js"></script>
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
</body>
</html>